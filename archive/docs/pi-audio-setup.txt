# Raspberry Pi 4 Audio/Video Setup for ParadoxFX System
# Date: July 10, 2025
# System: Raspberry Pi 4 with Bookworm OS

## Current System Configuration

### Hardware Setup
- Raspberry Pi 4 with dual HDMI outputs
- Screen 0: HDMI0 (first HDMI port, closest to USB-C power)
- Screen 1: HDMI1 (second HDMI port)
- Both screens connected and functioning

### Audio Devices Detected
```
Card 0: Headphones [bcm2835 Headphones] - 3.5mm analog jack
Card 1: vc4hdmi0 [vc4-hdmi-0] - HDMI0 digital audio
Card 2: vc4hdmi1 [vc4-hdmi-1] - HDMI1 digital audio
```

### PipeWire/PulseAudio Configuration
- PipeWire is running (modern replacement for PulseAudio)
- Audio sinks available:
  - alsa_output.platform-fef00700.hdmi.hdmi-stereo.2 (HDMI0)
  - alsa_output.platform-fef05700.hdmi.hdmi-stereo.2 (HDMI1)
  - alsa_output.platform-fe00b840.mailbox.stereo-fallback.2 (3.5mm jack)

### Current Working Configuration
- Audio routing: Can successfully switch between HDMI0 and HDMI1 using pactl commands
- Video routing: MPV can target different screens using display arguments
- Volume control: Set to 100% to avoid distortion (previous 140% caused audio distortion)

## CURRENT PROBLEM - UNRESOLVED

### Issue Description
**MPV video display targeting is inconsistent and not working as expected.**

### Symptoms
- When using `--fs-screen=1` in MPV arguments, video still displays on screen 0 instead of screen 1
- Audio routing works correctly and can be directed to the intended HDMI output
- Both `--screen=1` and `--fs-screen=1` arguments appear to have the same (incorrect) behavior

### Troubleshooting Attempted
1. Tried `--screen=1` argument - video went to screen 0
2. Tried `--fs-screen=1` argument - video still went to screen 0
3. Audio routing works correctly with pactl commands
4. Confirmed DISPLAY=:0 is correct for accessing the multi-monitor session

### Commands That Work
```bash
# Audio routing to HDMI0 (screen 0)
pactl set-default-sink alsa_output.platform-fef00700.hdmi.hdmi-stereo.2

# Audio routing to HDMI1 (screen 1)
pactl set-default-sink alsa_output.platform-fef05700.hdmi.hdmi-stereo.2

# Volume control
pactl set-sink-volume @DEFAULT_SINK@ 100%
```

### Commands That Don't Work As Expected
```bash
# These MPV arguments don't properly target screen 1:
mpv --fs-screen=1 --fullscreen video.mp4
mpv --screen=1 --fullscreen video.mp4
```

## SETUP STEPS COMPLETED

### 1. Audio System Initialization
- PipeWire is running and managing audio
- All HDMI audio outputs are detected and functional
- Volume levels configured (100% optimal, 140% causes distortion)

### 2. Display System
- Dual monitor setup working with X11/Wayland
- Both screens detected and accessible
- DISPLAY=:0 environment variable correctly set

### 3. Media Player Testing
- MPV installed and functional
- IPC communication working
- Audio playback confirmed on both HDMI outputs
- Video playback working but screen targeting broken

## FUTURE ACTION ITEMS

### Priority 1: Critical Issues

#### 1. Investigate MPV Screen Targeting
- **Problem**: MPV `--fs-screen=1` and `--screen=1` not working correctly
- **Research needed**:
  - Verify correct MPV arguments for multi-monitor setups on Pi4/Bookworm
  - Test alternative methods (xrandr, geometry settings, etc.)
  - Investigate if Wayland vs X11 affects screen targeting
  - Check MPV version and known issues with Pi4 hardware

#### 2. Audio System Architecture Decision
- **Investigation needed**: PipeWire vs PulseAudio
  - Current system uses PipeWire (modern default)
  - Determine if PulseAudio provides better control
  - Test compatibility with MPV and simultaneous audio streams
  - Performance comparison for real-time audio applications

### Priority 2: Advanced Configuration

#### 3. Multi-Instance MPV Investigation
- **Research question**: Can two different MPV instances simultaneously send:
  - Audio to different outputs (HDMI0 vs HDMI1 vs analog)
  - Video to different screens (screen 0 vs screen 1)
- **Test scenarios**:
  - Instance 1: Video on screen 0, audio on HDMI0
  - Instance 2: Video on screen 1, audio on HDMI1
  - Instance 3: Audio only on analog output (3.5mm jack)
- **Implications**: Would enable independent control per "screen device" in ParadoxFX

#### 4. Comprehensive Setup Guide Creation
- **Deliverable**: Complete setup script and documentation
- **Components needed**:
  - ALSA configuration for Pi4 dual HDMI
  - PipeWire/PulseAudio optimal settings
  - X11/Wayland display configuration
  - MPV compilation/configuration if needed
  - Automated detection and setup of audio devices
  - System service configuration for headless operation

### Priority 3: ParadoxFX Integration

#### 5. ParadoxFX .ini Configuration Design
- **Requirement**: Support audio routing per screen device
- **Design considerations**:
  - Screen device configuration options:
    - `audio_output=hdmi0` (HDMI0 audio)
    - `audio_output=hdmi1` (HDMI1 audio) 
    - `audio_output=analog` (3.5mm jack)
    - `audio_output=none` (video only)
  - Multiple simultaneous audio streams capability
  - Dynamic audio routing during runtime
  - Fallback behavior when preferred audio device unavailable

#### 6. Advanced Audio Scenarios
- **Investigation**: Simultaneous multi-device audio output
  - Can audio play to HDMI0 + HDMI1 + analog simultaneously?
  - Audio mixing and volume control per output
  - Latency considerations for synchronized playback
  - Resource usage and performance impact

## TECHNICAL NOTES

### Working Test Commands
```bash
# Check audio devices
aplay -l
pactl list short sinks

# Test audio on specific device
paplay /path/to/audio.wav

# Test video with audio
mpv --ao=pulse /path/to/video.mp4

# Check display configuration
xrandr --listmonitors
```

### Environment Requirements
```bash
export DISPLAY=:0  # Required for GUI applications
```

### MPV Test Configuration
Current test uses these arguments (screen targeting broken):
```
--idle=yes
--input-ipc-server=/tmp/mpv-screen-ipc.sock
--no-terminal
--fs-screen=1  # NOT WORKING - still displays on screen 0
--fullscreen
--keep-open=yes
--no-osd-bar
--msg-level=all=info
```

## SYSTEM STATUS SUMMARY

### ✅ Working Components
- Audio device detection and enumeration
- Audio routing between HDMI0, HDMI1, and analog outputs
- Video playback with audio synchronization
- MPV IPC communication and control
- PipeWire audio system functionality
- Volume control and adjustment

### ❌ Broken Components
- MPV video screen targeting (critical issue)
- Precise control over which monitor displays video content

### ⚠️ Untested Components
- Simultaneous multi-device audio output
- Multiple MPV instances with different audio/video targets
- Performance under load with multiple media streams
- System behavior in headless mode

## NEXT SESSION PRIORITIES

1. **Immediate**: Fix MPV screen targeting issue
2. **Research**: Alternative methods for video display control
3. **Testing**: Multi-instance MPV capabilities
4. **Documentation**: Create automated setup procedures

---
Generated: July 10, 2025
System: Raspberry Pi 4, Bookworm OS
Context: ParadoxFX multi-modal media controller development
