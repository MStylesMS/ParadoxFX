#!/bin/bash
# ParadoxFX Pi5 Optimized MPV Configuration
# Designed to minimize dropped frames on dual 4K setup

echo "üéØ ParadoxFX Pi5 Optimized Configuration"
echo "========================================"
echo ""

# Working MPV commands with performance optimizations
echo "‚úÖ CONFIRMED WORKING COMMANDS (X11):"
echo ""
echo "üñ•Ô∏è  SCREEN 0 (HDMI-1) - Performance Optimized:"
echo "mpv --screen=0 --fullscreen \\"
echo "    --audio-device=alsa/hdmi:CARD=vc4hdmi0,DEV=0 \\"
echo "    --vo=xv \\"
echo "    --hwdec=no \\"
echo "    --framedrop=vo \\"
echo "    --cache=yes --cache-secs=10 \\"
echo "    --no-osc --no-input-default-bindings \\"
echo "    [VIDEO_FILE]"
echo ""
echo "üñ•Ô∏è  SCREEN 1 (HDMI-2) - Performance Optimized:"
echo "mpv --screen=1 --fullscreen \\"
echo "    --audio-device=alsa/hdmi:CARD=vc4hdmi1,DEV=0 \\"
echo "    --vo=xv \\"
echo "    --hwdec=no \\"
echo "    --framedrop=vo \\"
echo "    --cache=yes --cache-secs=10 \\"
echo "    --no-osc --no-input-default-bindings \\"
echo "    [VIDEO_FILE]"
echo ""

echo "üîß OPTIMIZATION EXPLANATIONS:"
echo "- --vo=xv: Uses XV output (more efficient than GPU for most content)"
echo "- --hwdec=no: Disables problematic hardware decode"
echo "- --framedrop=vo: Drops frames to maintain sync (prevents stuttering)"
echo "- --cache=yes --cache-secs=10: Better buffering for smooth playback"
echo ""

echo "‚ö° FOR PARADOXFX INTEGRATION:"
echo ""
echo "Update your media player configuration with these parameters:"
echo ""
echo "const mpvArgs = ["
echo "    '--screen=' + screenNumber,"
echo "    '--fullscreen',"
echo "    '--audio-device=alsa/hdmi:CARD=vc4hdmi' + screenNumber + ',DEV=0',"
echo "    '--vo=xv',"
echo "    '--hwdec=no',"
echo "    '--framedrop=vo',"
echo "    '--cache=yes',"
echo "    '--cache-secs=10',"
echo "    '--no-osc',"
echo "    '--no-input-default-bindings',"
echo "    '--really-quiet',"
echo "    '--no-terminal',"
echo "    videoFile"
echo "];"
echo ""

echo "üìä PERFORMANCE NOTES:"
echo "- This configuration prioritizes smooth playback over max quality"
echo "- Frame dropping is enabled to prevent audio/video desync"  
echo "- Works reliably on Pi5 8GB with dual 4K displays"
echo "- Audio routing confirmed working to both HDMI outputs"
echo ""

echo "üéâ SOLUTION SUMMARY:"
echo "1. ‚úÖ X11 solves dual-screen video routing (Wayland fails)"
echo "2. ‚úÖ Audio routing works perfectly on both HDMI outputs"
echo "3. ‚úÖ Performance optimized for Pi5 + dual displays"
echo "4. ‚úÖ Ready for ParadoxFX production use"
