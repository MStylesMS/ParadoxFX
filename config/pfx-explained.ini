# ParadoxFX Raspberry Pi 4 Configuration
# =======================================
# Comprehensive configuration for Raspberry Pi 4 with dual HDMI and audio support
# Optimized for Pi4 with 2GB/4GB/8GB RAM running Raspberry Pi OS Bookworm
#
# Hardware Features Supported:
# - Dual HDMI video outputs (HDMI-0, HDMI-1) 
# - Dual HDMI audio outputs (independent routing)
# - 3.5mm headphone audio output
# - Hardware video acceleration (H.264/H.265)
# - GPU memory optimized for video performance
# - Multi-zone audio with background music, sound effects, and speech
#
# Platform-Specific Configuration:
# This file contains Pi4-specific optimizations. Other platforms use:
# - pfx-pi3.ini: Single HDMI + headphone audio
# - pfx-pi0w.ini: Mini HDMI optimized for lower performance
# - pfx-pi5.ini: Enhanced performance with updated device identifiers
# - pfx-linux.ini: Generic Linux with PulseAudio/PipeWire detection
#
# Copy this file to pfx.ini and customize for your installation

[mqtt]
# MQTT broker connection settings
broker = localhost
port = 1883
# username =                       # Not required for unsecured brokers
# password =                       # Not required for unsecured brokers
client_id = pfx-pi4-tripple-zone
keepalive = 60
clean_session = true

# Topic structure for Pi4 dual-zone setup
base_topic = paradox
device_name = pi4-tripple-zone

[global]
# Global application settings
log_level = info
media_base_path = /opt/paradox/media
heartbeat_enabled = true
heartbeat_interval = 10000           # 10 seconds
heartbeat_topic = paradox/heartbeat

# Pi4 performance optimizations
max_concurrent_videos = 2          # Pi4 can handle dual video streams
max_concurrent_audio_streams = 6   # Multiple audio streams per zone
enable_hardware_acceleration = true
prefer_h264_codec = true
gpu_memory_threshold = 128         # Minimum GPU memory for video

# Media player preferences
# Pi4 uses MPV exclusively for optimal performance and consistency
preferred_video_player = mpv
preferred_audio_player = mpv
preferred_image_player = mpv

# Volume configuration (0-150% range)
# Formula: effective_volume = main_volume × specific_volume × (100% - ducking%)
# Example: main=80%, background=60%, ducking=30% = 80% × 60% × 70% = 33.6%

# =============================================================================
# DUAL SCREEN CONFIGURATION (Pi4 Dual HDMI)
# =============================================================================

[screen:zone1-hdmi0]
type = screen
name = Zone 1 - Main Display
topic = paradox/zone1/screen
enabled = true                      # Set to false to disable this screen

# Media paths (relative to media_base_path unless absolute)
# - media_path = zone1     → /opt/paradox/media/zone1
# - media_path = ""        → /opt/paradox/media  
# - media_path = /zone3    → /zone3 (absolute path)
media_path = zone1

# Video configuration
display = :0
xinerama_screen = 0
monitor_geometry = auto           # Auto-detect HDMI-0 resolution
player_type = mpv
video_volume = 80                 # Main video volume (0-150%)
video_queue_max = 4

# Enhanced Audio System (HDMI-0 Audio)
# All volumes range 0-150%. Effective volume = video_volume × specific_volume × ducking_factor
audio_device = pulse/alsa_output.platform-fef00700.hdmi.hdmi-stereo
background_music_volume = 60      # Background music volume (0-150%)
ducking_volume = 30              # Duck to 30% when other audio plays
effects_volume = 100             # Sound effects volume (0-150%)  
speech_volume = 90               # Speech/narration volume (0-150%)
audio_queue_max = 8

# Pi4 MPV optimization for HDMI-0
mpv_video_options = --hwdec=auto --vo=gpu --gpu-context=drm --profile=gpu-hq --cache=yes --cache-secs=5
mpv_audio_options = --audio-device=pulse/alsa_output.platform-fef00700.hdmi.hdmi-stereo --volume=70

[screen:zone2-hdmi1]
type = screen
name = Zone 2 - Secondary Display  
topic = paradox/zone2/screen
enabled = true                    # Set to false to disable this screen

# Media paths (relative to media_base_path unless absolute)
media_path = zone2

# Video configuration
display = :0
xinerama_screen = 1
monitor_geometry = auto           # Auto-detect HDMI-1 resolution
player_type = mpv
video_volume = 70                 # Main video volume (0-150%)
video_queue_max = 4

# Enhanced Audio System (HDMI-1 Audio)
# All volumes range 0-150%. Effective volume = video_volume × specific_volume × ducking_factor
audio_device = pulse/alsa_output.platform-fef05700.hdmi.hdmi-stereo
background_music_volume = 50      # Background music volume (0-150%)
ducking_volume = 30              # Duck to 30% when other audio plays
effects_volume = 100             # Sound effects volume (0-150%)
speech_volume = 90               # Speech/narration volume (0-150%)
audio_queue_max = 8

# Pi4 MPV optimization for HDMI-1
mpv_video_options = --hwdec=auto --vo=gpu --gpu-context=drm --profile=gpu-hq --cache=yes --cache-secs=5
mpv_audio_options = --audio-device=pulse/alsa_output.platform-fef05700.hdmi.hdmi-stereo --volume=70

# =============================================================================
# HEADPHONE AUDIO ZONE (Pi4 3.5mm Jack)
# =============================================================================

[audio:headphones]
type = audio
name = Headphone Audio Zone
topic = paradox/headphones/audio
enabled = false                   # Set to true to enable headphone audio zone

# Audio configuration for 3.5mm jack
audio_device = pulse/alsa_output.platform-fef00700.hdmi.hdmi-stereo
background_music_volume = 40      # Lower volume for headphones (0-150%)
ducking_volume = 30              # Duck to 30% when other audio plays
effects_volume = 80              # Sound effects volume (0-150%)
speech_volume = 75               # Speech/narration volume (0-150%)
audio_queue_max = 5

# Headphone-optimized audio settings
mpv_audio_options = --audio-device=pulse/alsa_output.platform-fef00700.hdmi.hdmi-stereo --volume=60

# =============================================================================
# LIGHTING SYSTEM CONFIGURATION
# =============================================================================

[light:zone1-main]
type = light
name = Zone 1 Main Lighting
topic = paradox/zone1/lights/main
controller = hue
bridge_ip = 192.168.1.100
bridge_username = your-hue-username
device_id = zone1_main_light

[light:zone1-accent]
type = light
name = Zone 1 Accent Lighting
topic = paradox/zone1/lights/accent
controller = wiz
bulb_ip = 192.168.1.101
device_id = zone1_accent_light

[light:zone2-main]
type = light
name = Zone 2 Main Lighting
topic = paradox/zone2/lights/main
controller = hue
bridge_ip = 192.168.1.100
bridge_username = your-hue-username
device_id = zone2_main_light

[light:zone2-accent]
type = light
name = Zone 2 Accent Lighting
topic = paradox/zone2/lights/accent
controller = zigbee
device_id = 0x00158d0001234567

# Light groups for synchronized control
[light-group:zone1-all]
type = light-group
name = Zone 1 All Lights
topic = paradox/zone1/lights/all
devices = zone1-main,zone1-accent

[light-group:zone2-all]
type = light-group
name = Zone 2 All Lights
topic = paradox/zone2/lights/all
devices = zone2-main,zone2-accent

[light-group:all-zones]
type = light-group
name = All Zones Lighting
topic = paradox/all-zones/lights
devices = zone1-main,zone1-accent,zone2-main,zone2-accent

# =============================================================================
# RELAY AND AUTOMATION DEVICES
# =============================================================================

[relay:zone1-power]
type = relay
name = Zone 1 Power Control
topic = paradox/zone1/power
controller = zwave
node_id = 5
device_type = switch

[relay:zone2-power]
type = relay
name = Zone 2 Power Control
topic = paradox/zone2/power
controller = zwave
node_id = 6
device_type = switch

[relay:master-emergency]
type = relay
name = Emergency Stop All
topic = paradox/emergency/stop-all
controller = zigbee
device_id = 0x00158d0001234568
device_type = emergency_stop

# Door/entrance controls
[relay:entrance-lock]
type = relay
name = Entrance Door Lock
topic = paradox/entrance/door-lock
controller = zigbee
device_id = 0x00158d0001234569
device_type = door_lock

[relay:maintenance-mode]
type = relay
name = Maintenance Mode Switch
topic = paradox/maintenance/mode
controller = zwave
node_id = 7
device_type = mode_switch

# =============================================================================
# CONTROLLER CONFIGURATIONS
# =============================================================================

[controller:hue]
type = hue
name = Philips Hue Bridge
bridge_ip = 192.168.1.100
bridge_username = your-hue-username
polling_interval = 5000
max_retries = 3
timeout = 10000

[controller:wiz]
type = wiz
name = WiZ Smart Lighting
discovery_enabled = true
polling_interval = 10000
max_devices = 20
timeout = 5000

[controller:zigbee]
type = zigbee
name = Zigbee Coordinator
serial_port = /dev/ttyUSB0
channel = 11
pan_id = 0x1234
network_key = auto
permit_join = false
polling_interval = 15000

[controller:zwave]
type = zwave
name = Z-Wave Controller
serial_port = /dev/ttyACM0
network_key = 0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0A,0x0B,0x0C,0x0D,0x0E,0x0F,0x10
healing_interval = 86400000      # 24 hours
include_timeout = 30000
exclude_timeout = 30000

# =============================================================================
# ADVANCED PI4 CONFIGURATION
# =============================================================================

[pi4_optimization]
# GPU configuration (requires config.txt settings)
gpu_mem = 128                    # For 2GB Pi4, use 256 for 4GB+, 512 for 8GB
enable_4kp60 = true             # Enable 4K@60fps support
hdmi_force_hotplug = true       # Force HDMI detection
hdmi_drive = 2                  # Enable full HDMI output

# Audio system optimization
audio_buffer_size = 0.02        # Low latency audio buffer
audio_cache_enabled = false     # Disable caching for effects
audio_exclusive_mode = true     # Request exclusive audio access

# Performance monitoring
monitor_gpu_temp = true
monitor_cpu_temp = true
monitor_memory_usage = true
performance_log_interval = 60000

# Network optimization
mqtt_qos = 1
mqtt_retain = false
mqtt_compression = false

# =============================================================================
# DEVICE ALIASES AND SHORTCUTS
# =============================================================================

[aliases]
# Quick access device aliases for MQTT commands
main_screen = zone1-hdmi0
secondary_screen = zone2-hdmi1
all_screens = zone1-hdmi0,zone2-hdmi1
all_lights = zone1-all,zone2-all
all_audio = zone1-hdmi0,zone2-hdmi1,headphones
emergency_devices = master-emergency,zone1-power,zone2-power

# =============================================================================
# FAIL-SAFE AND RECOVERY SETTINGS
# =============================================================================

[failsafe]
# Automatic recovery settings (PLANNED - Not yet implemented)
auto_restart_on_failure = true
max_restart_attempts = 3
restart_delay_ms = 5000

# Emergency shutdown (IMPLEMENTED - Basic error reporting)
emergency_stop_topic = paradox/emergency/stop
emergency_stop_timeout = 5000

# Watchdog settings (PLANNED - Not yet implemented)
enable_watchdog = true
watchdog_interval = 30000
watchdog_timeout = 60000

# Backup configurations
config_backup_enabled = true
config_backup_interval = 86400000  # 24 hours
config_backup_path = /opt/paradox/backups

# =============================================================================
# LOGGING AND DEBUGGING
# =============================================================================

[logging]
# Log levels: error, warn, info, debug, trace
default_level = info
audio_level = info
video_level = info
mqtt_level = warn
controller_level = info

# Log destinations
log_to_file = true
log_file_path = /var/log/paradoxfx/pfx-pi4.log
log_rotation = true
log_max_size = 10MB
log_max_files = 5

# Performance logging
performance_logging = true
latency_monitoring = true
resource_monitoring = true

# Debug options (disable in production)
debug_mqtt = false
debug_audio = false
debug_video = false
debug_controllers = false
